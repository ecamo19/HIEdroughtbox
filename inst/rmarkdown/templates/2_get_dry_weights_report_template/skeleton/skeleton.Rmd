---
title: 'Dry weights: Species Name'
author: 'Your Name'
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  prettydoc::html_pretty:
    highlight: pygments
    theme: cayman
    toc: yes
    number_sections: no
    toc_depth: 1
---

```{r, setup_wd, include=FALSE}
# Set knit directory
setwd(here::here())
knitr::opts_knit$set(root.dir = setwd(here::here()))
getwd()
```

```{r setup, include = FALSE}
options(scipen = 999)

# Save figures in specific place
knitr::opts_chunk$set(autodep        = TRUE,
                      cache          = FALSE,
                      cache.comments = TRUE,
                      comment = "",
                      # Save figures as pdf ?
                      #dev = c( "png", "pdf"),
                  
                      # Include code?
                      echo           = TRUE,
                      error          = FALSE,
                      fig.align      = "center",
                      
                      # Path where figures are going to be store pdf single 
                      # figures
                      Edit path in line 44 and comment out this line   
                      fig.path       = paste0("./droughtbox_data/figures_[sp_name]_gres", "/"),
                      fig.width      = 11,
                      fig.height     = 7,
                      message        = FALSE,
                      warning        = FALSE)
```

```{r cleanup-docs, cache = FALSE,echo = FALSE}
# save a html copy file in a specific place
# doc.files <- c(list.files(pattern = "pdf"),
#                list.files(pattern = "html"),
#                list.files(pattern = "docx"))
# 
# for (file in doc.files) {   
#     file.rename(file, file.path("../../[insert_folder_name]/", file))
# }
```

```{r, libaries, message = FALSE, warning = FALSE, cache = FALSE}
library(HIEdroughtbox)
library(ggplot2)

# For data manipulation
library(dplyr)
library(ggplot2)
library(purrr)
library(stringr)
library(tidyr)
library(here)
library(tibble)

# For reading xlsx file
library(readxl)
```

# Load dry weights data from the Droughtbox 

```{r, load_raw_data}
raw_dry_weights_data <- read_dry_weights_data_folder("")
```

```{r}
names(raw_dry_weights_data)
```

# Plot raw data 

```{r, plot_raw_data}
map(raw_dry_weights_data, plot_strains_weights)
```

# Clean datasets

## File 1: 25c

```{r, eval=FALSE}
[spcode]_25c_dry_weights_cleaned <-

    # Select the data to be clean
    raw_dry_weights_data["dry_weight_[spcode]_25c.dat"] %>%

    # Transform list element to dataframe type
    as.data.frame(.) %>%

    # clean colnames
    `colnames<-`(str_extract(colnames(.), '\\b\\w+$')) %>%

    # Choose a interval of time
    filter_droughtbox_data(.,
                           from_start_time = "HH:MM:SS",
                           to_end_time = "HH:MM:SS")  
```

### Plot cleaned data

```{r, plot_dry_weights_cleaned_data_25c, eval=FALSE}
plot_strains_weights([spcode]_25c_dry_weights_cleaned, show_tare_group = FALSE)
```

### Reshape data

```{r, eval=FALSE}
[spcode]_25c_dry_weights_cleaned <-
  
    [spcode]_25c_dry_weights_cleaned %>% 

    select(date_time, strain_avg_1_microstrain_avg, strain_avg_2_microstrain_avg,
            strain_avg_3_microstrain_avg, strain_avg_4_microstrain_avg,
            strain_avg_5_microstrain_avg, strain_avg_6_microstrain_avg,
            strain_avg_7_microstrain_avg, strain_avg_8_microstrain_avg) %>%
  
    add_column(file = "25c") %>% 
    
    # Pivot data
    pivot_longer(!c(date_time, file), names_to = "string", values_to = "weight_grams")  %>% 

    # Edit names
    mutate(string_number = case_when(string == "strain_avg_1_microstrain_avg"  ~ "strain_1",
                                     string == "strain_avg_2_microstrain_avg"  ~ "string_2",
                                     string == "strain_avg_3_microstrain_avg"  ~ "string_3",
                                     string == "strain_avg_4_microstrain_avg"  ~ "string_4",
                                     string == "strain_avg_5_microstrain_avg"  ~ "string_5",
                                     string == "strain_avg_6_microstrain_avg"  ~ "string_6",
                                     string == "strain_avg_7_microstrain_avg"  ~ "string_7",
                                     string == "strain_avg_8_microstrain_avg"  ~ "string_8",
                                     TRUE ~ string), .keep = "unused") %>%   
        
        group_by(string_number, file) %>% 
        summarise(weight_grams = mean(weight_grams))    
    
```

```{r, eval=FALSE}
glimpse([spcode]_25c_dry_weights_cleaned)
```

## File 2: 30c 

```{r, eval=FALSE}
[spcode]_30c_dry_weights_cleaned <-

    # Select the data to be clean
    raw_dry_weights_data["dry_weight_[spcode]_30c.dat"] %>%

    # Transform list element to dataframe type
    as.data.frame(.) %>%

    # clean colnames
    `colnames<-`(str_extract(colnames(.), '\\b\\w+$')) %>%

    # Choose a interval of time
    filter_droughtbox_data(.,
                           from_start_time = "HH:MM:SS",
                           to_end_time = "HH:MM:SS")  
```

### Plot cleaned data

```{r, plot_dry_weights_cleaned_data_30c, eval=FALSE}
plot_strains_weights([spcode]_30c_dry_weights_cleaned, show_tare_group = FALSE)
```

### Reshape data

```{r, eval=FALSE}
[spcode]_30c_dry_weights_cleaned <-
  
    [spcode]_30c_dry_weights_cleaned %>% 

    select(date_time, strain_avg_1_microstrain_avg, strain_avg_2_microstrain_avg,
            strain_avg_3_microstrain_avg, strain_avg_4_microstrain_avg,
            strain_avg_5_microstrain_avg, strain_avg_6_microstrain_avg,
            strain_avg_7_microstrain_avg, strain_avg_8_microstrain_avg) %>%
  
    add_column(file = "30c") %>% 
    
    # Pivot data
    pivot_longer(!c(date_time, file), names_to = "string", values_to = "weight_grams")  %>% 

    # Edit names
    mutate(string_number = case_when(string == "strain_avg_1_microstrain_avg"  ~ "strain_1",
                                     string == "strain_avg_2_microstrain_avg"  ~ "string_2",
                                     string == "strain_avg_3_microstrain_avg"  ~ "string_3",
                                     string == "strain_avg_4_microstrain_avg"  ~ "string_4",
                                     string == "strain_avg_5_microstrain_avg"  ~ "string_5",
                                     string == "strain_avg_6_microstrain_avg"  ~ "string_6",
                                     string == "strain_avg_7_microstrain_avg"  ~ "string_7",
                                     string == "strain_avg_8_microstrain_avg"  ~ "string_8",
                                     TRUE ~ string), .keep = "unused") %>%   
        
        group_by(string_number, file) %>% 
        summarise(weight_grams = mean(weight_grams))
```

```{r, eval=FALSE}
glimpse([spcode]_30c_dry_weights_cleaned)
```

## File 3: 35c

```{r, eval=FALSE}
[spcode]_35c_dry_weights_cleaned <-

    # Select the data to be clean
    raw_dry_weights_data["dry_weight_[spcode]_35c.dat"] %>%

    # Transform list element to dataframe type
    as.data.frame(.) %>%

    # clean colnames
    `colnames<-`(str_extract(colnames(.), '\\b\\w+$')) %>%

    # Choose a interval of time
    filter_droughtbox_data(.,
                           from_start_time = "HH:MM:SS",
                           to_end_time = "HH:MM:SS")  
```

### Plot cleaned data

```{r, plot_dry_weights_cleaned_data_35c, eval=FALSE}
plot_strains_weights([spcode]_35c_dry_weights_cleaned, show_tare_group = FALSE)
```

### Reshape data

```{r, eval=FALSE}
[spcode]_35c_dry_weights_cleaned <-
  
    [spcode]_35c_dry_weights_cleaned %>% 

    select(date_time, strain_avg_1_microstrain_avg, strain_avg_2_microstrain_avg,
            strain_avg_3_microstrain_avg, strain_avg_4_microstrain_avg,
            strain_avg_5_microstrain_avg, strain_avg_6_microstrain_avg,
            strain_avg_7_microstrain_avg, strain_avg_8_microstrain_avg) %>%
  
    add_column(file = "35c") %>% 
  
    pivot_longer(!c(date_time, file), names_to = "string", values_to = "weight_grams")  %>%
  
    # Edit names
    mutate(string_number = case_when(string == "strain_avg_1_microstrain_avg"  ~ "strain_1",
                                     string == "strain_avg_2_microstrain_avg"  ~ "string_2",
                                     string == "strain_avg_3_microstrain_avg"  ~ "string_3",
                                     string == "strain_avg_4_microstrain_avg"  ~ "string_4",
                                     string == "strain_avg_5_microstrain_avg"  ~ "string_5",
                                     string == "strain_avg_6_microstrain_avg"  ~ "string_6",
                                     string == "strain_avg_7_microstrain_avg"  ~ "string_7",
                                     string == "strain_avg_8_microstrain_avg"  ~ "string_8",
                                     TRUE ~ string), .keep = "unused") %>%   
        
    group_by(string_number, file) %>%
    summarise(weight_grams = mean(weight_grams))
```

```{r, eval=FALSE}
glimpse([spcode]_35c_dry_weights_cleaned)
```

## File 4: 40c

```{r, eval=FALSE}
[spcode]_40c_dry_weights_cleaned <-

    # Select the data to be clean
    raw_dry_weights_data["dry_weight_[spcode]_40c.dat"] %>%

    # Transform list element to dataframe type
    as.data.frame(.) %>%

    # clean colnames
    `colnames<-`(str_extract(colnames(.), '\\b\\w+$')) %>%

    # Choose a interval of time
    filter_droughtbox_data(.,
                           from_start_time = "HH:MM:SS",
                           to_end_time = "HH:MM:SS")  
```

### Plot cleaned data

```{r, plot_dry_weights_cleaned_data_40c, eval=FALSE}
plot_strains_weights([spcode]_40c_dry_weights_cleaned, show_tare_group = FALSE)
```

### Reshape data

```{r, eval=FALSE}
[spcode]_40c_dry_weights_cleaned <-
  
    [spcode]_40c_dry_weights_cleaned %>% 

    select(date_time, strain_avg_1_microstrain_avg, strain_avg_2_microstrain_avg,
            strain_avg_3_microstrain_avg, strain_avg_4_microstrain_avg,
            strain_avg_5_microstrain_avg, strain_avg_6_microstrain_avg,
            strain_avg_7_microstrain_avg, strain_avg_8_microstrain_avg) %>%
  
    add_column(file = "40c") %>% 
  
    pivot_longer(!c(date_time, file), names_to = "string", values_to = "weight_grams")  %>% 

    # Edit names
    mutate(string_number = case_when(string == "strain_avg_1_microstrain_avg"  ~ "strain_1",
                                     string == "strain_avg_2_microstrain_avg"  ~ "string_2",
                                     string == "strain_avg_3_microstrain_avg"  ~ "string_3",
                                     string == "strain_avg_4_microstrain_avg"  ~ "string_4",
                                     string == "strain_avg_5_microstrain_avg"  ~ "string_5",
                                     string == "strain_avg_6_microstrain_avg"  ~ "string_6",
                                     string == "strain_avg_7_microstrain_avg"  ~ "string_7",
                                     string == "strain_avg_8_microstrain_avg"  ~ "string_8",
                                     TRUE ~ string), .keep = "unused") %>%   
        
    group_by(string_number, file) %>% 
    summarise(weight_grams = mean(weight_grams))
```

```{r, eval = FALSE}
glimpse([spcode]_40c_dry_weights_cleaned)
```

## File 5: 45c

```{r, eval=FALSE}
[spcode]_45c_dry_weights_cleaned <-

    # Select the data to be clean
    raw_dry_weights_data["dry_weight_[spcode]_45c.dat"] %>%

    # Transform list element to dataframe type
    as.data.frame(.) %>%

    # clean colnames
    `colnames<-`(str_extract(colnames(.), '\\b\\w+$')) %>%

    # Choose a interval of time
    filter_droughtbox_data(.,
                           from_start_time = "HH:MM:SS",
                           to_end_time = "HH:MM:SS")  
```

### Plot cleaned data

```{r, plot_dry_weights_cleaned_data_45c, eval=FALSE}
plot_strains_weights([spcode]_45c_dry_weights_cleaned, show_tare_group = FALSE)
```

### Reshape data

```{r, eval=FALSE}
[spcode]_45c_dry_weights_cleaned <-
  
    [spcode]_45c_dry_weights_cleaned %>% 

    select(date_time, strain_avg_1_microstrain_avg, strain_avg_2_microstrain_avg,
            strain_avg_3_microstrain_avg, strain_avg_4_microstrain_avg,
            strain_avg_5_microstrain_avg, strain_avg_6_microstrain_avg,
            strain_avg_7_microstrain_avg, strain_avg_8_microstrain_avg) %>%
  
    add_column(file = "45c") %>% 
  
    pivot_longer(!c(date_time, file), names_to = "string", values_to = "weight_grams")  %>% 

    # Edit names
    mutate(string_number = case_when(string == "strain_avg_1_microstrain_avg"  ~ "strain_1",
                                     string == "strain_avg_2_microstrain_avg"  ~ "string_2",
                                     string == "strain_avg_3_microstrain_avg"  ~ "string_3",
                                     string == "strain_avg_4_microstrain_avg"  ~ "string_4",
                                     string == "strain_avg_5_microstrain_avg"  ~ "string_5",
                                     string == "strain_avg_6_microstrain_avg"  ~ "string_6",
                                     string == "strain_avg_7_microstrain_avg"  ~ "string_7",
                                     string == "strain_avg_8_microstrain_avg"  ~ "string_8",
                                     TRUE ~ string), .keep = "unused") %>%   
      
    group_by(string_number, file) %>% 
    summarise(weight_grams = mean(weight_grams))
```

```{r, eval=FALSE}
glimpse([spcode]_45c_dry_weights_cleaned)
```

## File 6: 50c

```{r, eval=FALSE}
[spcode]_50c_dry_weights_cleaned <-

    # Select the data to be clean
    raw_dry_weights_data["dry_weight_[spcode]_50c.dat"] %>%

    # Transform list element to dataframe type
    as.data.frame(.) %>%

    # clean colnames
    `colnames<-`(str_extract(colnames(.), '\\b\\w+$')) %>%

    # Choose a interval of time
    filter_droughtbox_data(.,
                           from_start_time = "HH:MM:SS",
                           to_end_time = "HH:MM:SS")  
```

### Plot cleaned data

```{r, plot_dry_weights_cleaned_data_50c, eval=FALSE}
plot_strains_weights([spcode]_50c_dry_weights_cleaned, show_tare_group = FALSE)
```

### Reshape data

```{r, eval=FALSE}
[spcode]_50c_dry_weights_cleaned <-
  
    [spcode]_50c_dry_weights_cleaned %>% 

    select(date_time, strain_avg_1_microstrain_avg, strain_avg_2_microstrain_avg,
            strain_avg_3_microstrain_avg, strain_avg_4_microstrain_avg,
            strain_avg_5_microstrain_avg, strain_avg_6_microstrain_avg,
            strain_avg_7_microstrain_avg, strain_avg_8_microstrain_avg) %>%
  
    add_column(file = "50c") %>% 
  
    pivot_longer(!c(date_time, file), names_to = "string", values_to = "weight_grams")  %>% 

    # Edit names
    mutate(string_number = case_when(string == "strain_avg_1_microstrain_avg"  ~ "strain_1",
                                     string == "strain_avg_2_microstrain_avg"  ~ "string_2",
                                     string == "strain_avg_3_microstrain_avg"  ~ "string_3",
                                     string == "strain_avg_4_microstrain_avg"  ~ "string_4",
                                     string == "strain_avg_5_microstrain_avg"  ~ "string_5",
                                     string == "strain_avg_6_microstrain_avg"  ~ "string_6",
                                     string == "strain_avg_7_microstrain_avg"  ~ "string_7",
                                     string == "strain_avg_8_microstrain_avg"  ~ "string_8",
                                     TRUE ~ string), .keep = "unused") %>%   
        
    group_by(string_number, file) %>% 
    summarise(weight_grams = mean(weight_grams))
```

```{r, eval=FALSE}
glimpse([spcode]_50c_dry_weights_cleaned)
```

## File 7: 55c

```{r, eval=FALSE}
[spcode]_55c_dry_weights_cleaned <-

    # Select the data to be clean
    raw_dry_weights_data["dry_weight_[spcode]_55c.dat"] %>%

    # Transform list element to dataframe type
    as.data.frame(.) %>%

    # clean colnames
    `colnames<-`(str_extract(colnames(.), '\\b\\w+$')) %>%

    # Choose a interval of time
    filter_droughtbox_data(.,
                           from_start_time = "HH:MM:SS",
                           to_end_time = "HH:MM:SS")  
```

### Plot cleaned data

```{r, plot_dry_weights_cleaned_data_55c, eval=FALSE}
plot_strains_weights([spcode]_55c_dry_weights_cleaned, show_tare_group = FALSE)
```

### Reshape data

```{r, eval=FALSE}
[spcode]_55c_dry_weights_cleaned <-
  
    [spcode]_55c_dry_weights_cleaned %>% 

    select(date_time, strain_avg_1_microstrain_avg, strain_avg_2_microstrain_avg,
            strain_avg_3_microstrain_avg, strain_avg_4_microstrain_avg,
            strain_avg_5_microstrain_avg, strain_avg_6_microstrain_avg,
            strain_avg_7_microstrain_avg, strain_avg_8_microstrain_avg) %>%
  
    add_column(file = "55c") %>% 
  
    pivot_longer(!c(date_time, file), names_to = "string", values_to = "weight_grams")  %>% 

    # Edit names
    mutate(string_number = case_when(string == "strain_avg_1_microstrain_avg"  ~ "strain_1",
                                     string == "strain_avg_2_microstrain_avg"  ~ "string_2",
                                     string == "strain_avg_3_microstrain_avg"  ~ "string_3",
                                     string == "strain_avg_4_microstrain_avg"  ~ "string_4",
                                     string == "strain_avg_5_microstrain_avg"  ~ "string_5",
                                     string == "strain_avg_6_microstrain_avg"  ~ "string_6",
                                     string == "strain_avg_7_microstrain_avg"  ~ "string_7",
                                     string == "strain_avg_8_microstrain_avg"  ~ "string_8",
                                     TRUE ~ string), .keep = "unused") %>%   
    group_by(string_number, file) %>% 
    summarise(weight_grams = mean(weight_grams))    
```


```{r, eval=FALSE}
glimpse([spcode]_55c_dry_weights_cleaned)
```

# Construct dry weights dataset

```{r, eval=FALSE}
[spcode]_dry_weights <- 

  list([spcode]_25c_dry_weights_cleaned,
       [spcode]_30c_dry_weights_cleaned,
       [spcode]_35c_dry_weights_cleaned,
       [spcode]_40c_dry_weights_cleaned,
       [spcode]_45c_dry_weights_cleaned,
       [spcode]_50c_dry_weights_cleaned,
       [spcode]_55c_dry_weights_cleaned) %>%
  
  reduce(full_join) %>% 
  add_column(spcode = [spcode])
```

```{r, eval=FALSE}
glimpse([spcode]_dry_weights)
```

# Load paper bag weights

```{r, eval=FALSE}
paper_bag_weights <- read.csv("", header = TRUE)
```

## Select paper bag group

```{r, eval=FALSE}
paper_bag_weights_group_ <- 
    paper_bag_weights %>% 
        filter(paper_bag_group == "group_")
```

## Join paper bag weights and dry weights

```{r, eval=FALSE}
[spcode]_dry_weights <- 
  
  inner_join(euc_saligna_dry_weights, paper_bag_weights_group_1,
             by = join_by(string_number, file )) %>%
  
  select(spcode, paper_bag_group, string_number, everything()) %>% 
  
  # Subtract the paper bag weight
  mutate(.keep = "unused", sample_dry_weight_grams = weight_grams - paperbag_weight_grams)
```

# Save dry weights data

```{r, eval=FALSE}
write.csv([spcode]_dry_weights, "/processed_data/[spcode]_dry_weights.csv")
```


